---
title: "CCNA 공부를 위해"
date: 2024-04-02 21:09:15 +09:00
categories: [CCNA]
tags: [노력]
---

# 공부하고 기억하기 위한 기록

## 네트워킹이란?

 네트워킹 (Networking)은 '장비가 서로 대화가 가능하도록 묶어주는 것' 이다.

## 인터넷, 인트라넷, 엑스트라넷?

### 인터넷 (Internet) : 여러개의 네트워크를 묶은 것
 1. 프로토콜(대화규칙 : TCP/IP)를 사용한다.
 2. 웹 브라우저를이용해 탐험이 가능하다.

### 인트라넷 (IntraNet)
> 내부 네트워크
### 엑스트라넷 (ExtraNet)
> 인트라넷을 기업 내 외에도 사용할 수 있도록 한 것

## LAN(Local Area Network)
 어느 한정된 공간에서 네트워크를 구성한다.
## WAN(Wide Area Network)
 멀리 떨어진 지역을 서로 연결하는 경우에 사용한다.

## 이더넷 (Ethernet)
 > 인터넷 아닙니다.
 이더넷은 네트워킹의 한 방식이다.

 CSMA/CD 프로토콜을 이용하여 통신을 하게 된다.

 쉽게말해 통신하려는 네트워크를 살펴본 후 아무도 통신하고있지 않으면 본인 데이터를 실어보내고 잘 보내졌는지 확인하는 방식이다.

 ### CSMA/CD
  > Carrier Sense Multiple Access/Collision Detection

  Carrier Sense : 네트워크 자원(캐리어)를 감지한다.

  Multiple Access : 동시에 접속이 가능하다.

  Collision Detection : 여러 장비가 동시에 정보를 전달하면 충돌이 발생한다.

  충돌이 감지되면 랜덤한 시간동안 최대 15번 까지 데이터 전송을 시도하고 그 이후에는 데이터 전송을 포기한다.

## 토큰링 (TokenRing)
 &nbsp; 이더넷은 데이터를 보내고 싶으면 마음껏 보내지만 토큰링 방식은 네트워크상에서 토큰을 가진 한 PC만이 네트워크에 데이터를 보낼 수 있는 방식이다.

## TP 케이블

> Twisted - Pair Cable

### UTP 케이블

> Unshielded Twisted - Pair Cable
>
> 케이블 주위를 절연체로 감싸지 않음

### STP 케이블

> shielded Twisted - Pair Cable
>
> 케이블 주위를 절연체로 감싸고 있음
>
> 주로 토큰링 쪽에서 사용 

### 카테고리 - 데이터 전송 속도에 따라서 나뉜다.

- 카테고리 1 : 전화망에 사용, 데이터 전송용 X
- 카테고리 2 : 4Mbps 속도로 데이터 전송
- 카테고리 3 : 최대 10Mbps, 속도까지 데이터 전송가능
- 카테고리 4 : 최대 16Mbps, 토큰링에서 사용되는 케이블
- 카테고리 5 : 최대 100Mbps, 였으나 이제는 Gbps속도의 전송도 가능해짐
- 카테고리 6 : 최대 10Gbps , Cat6와 Cat6a 케이블로 구분되고 a가 붙은 케이블이 좀 더 개선된 케이블이다.
- 카테고리 7 : 10Gbps 이상의 속도 지원

### 케이블 이름

> 예시를 들어보자
- 10 Base T

 10Mbps의 속도를 지원하는 Baseband용(베이스밴드- 디지털방식, 브로드밴드 - 아날로그 방식)이고 T(Twisted Pair) 케이블이다..

- 10 Base T : 10Mbps로 통신하고 최대 전송거리 100M인 UTP케이블
- 10 Base FL : 10Mbps로 통신하는 광케이블 FL(Fiber - Optic)
- 10 Base 2 : 10Mbps로 통신하고 200M까지 전송가능한 케이블

 이런 식으로 명명된다.

## 맥 어드레스 (MAC Address)

 > MAC (Media Access Control) OR Physical Address (물리적 주소)

 > IP, IPX (Logical 주소)

 - ARP : Address Resolution Protocol - IP주소를 다시 MAC으로 바꾸는 절차

 네트워크 장비들은 48bit(6Octet)의 주소를 갖는다. 이 주소를 `맥 어드레스` 혹은 `하드웨어 주소`라고 한다. 맥 어드레스는 8자리마다 `-` `:`  `.` 으로 고분된다.

 앞쪽 6개의 16진수는 벤더(생산자)를 의미한다. 이 코드를 `OUI(Organizational Unique Identifier)`라고 한다. 뒤에 나오는 6자리 수는 `Host Identifier(시리얼 넘버)`이다.

 ```
 O는 OUI, H는 host identifier

 OOOO.OOHH.HHHH
 ```

## 유니캐스트, 브로드캐스트, 멀티캐스트
> Unicast, Broadcast, Multicast

### 유니캐스트 (Unicast)
 1 대 1, 보내는 사람과 받는 사람의 MAC주소가 프레임에 들어있다. 

 - 여러 사람한테 보내게 되면 트래픽이 증가하기에 그 때에는 Multicast를 이용한다.

 `편지 보내기`

### 브로드캐스트 (Broadcast)
 로컬 랜(브로드캐스트 도메인)에 붙어있는 모든 네트워크 장비들에게 보내는 통신

 - 브로드캐스트 MAC 주소는 정해져있다. (FFFF.FFFF.FFFF)

 - 처음 두 PC 간에 통신을 하는 경우 상대의 MAC 주소를 알아내기 위해 ARP(Address Resolution Protocol)을 한다.

 - 브로드캐스트는 유니캐스트와 달리 CPU에 영향을 주게된다.

 `동내 이장님 방송`

### 멀티캐스트 (Multicast)

 그룹 멤버들에게만 한번에 보낼 수 있다.

 - 라우터나 스위치에서 기능을 지원해 주어야지만 사용가능하다.

 - 만약 지원되지 않는 라우터나 스위치를 사용하면 스위치는 모든 포트에 뿌리고 라우터는 브로드캐스트라고 인식하여 차단한다.

### 정리

 - 유니캐스트 - 특정 한 PC에만 보내는 방식
 - 브로드캐스트 - 브로드캐스트 도메인 안에있는 모든 PC에 전송, PC(CPU) 성능이 떨어지게된다.
 - 멀티캐스트 - 위 두 방식의 장점을 결합해 놓았지만 라우터나 스위치가 지원하여야 사용 가능하다.
  
## OSI 7 Layer 
 > Open Systems Interconnection

 - Application Layer (애플리케이션 계층)
 - Presentation Layer (프레젠테이션 계층)
 - Session Layer (세션 계층)
 - Transport Layer (트랜스포트 계층)
 - Network Layer (네트워크 계층)
 - Data Link Layer (데이터 링크 계층)
 - Physical Layer (피지컬 계층)

애프세트네데피 로 외워봅시다.

### 가장 아래 계층 레이어 1 Physical Layer

 전기적, 기계적 특성을 이용해 통신 케이블로 데이터를 전송. 
 > 케이블, 리피터, 허브 등

### 레이어 2 Data Link Layer

 송,수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 할 수 있도록 도와준다. MAC 주소로 통신할 수 있도록 해준다. 
 
 이 계층에서 전송되는 단위를 `프레임`이라고 부른다. 
  > 브리지, 스위치

### 레이어 3 NetWork Layer

 경로를 선택하고, 주소 선정, 경로를 따라 패킷을 전달해 주는 역할.
 
 > 라우터, Layer 3 스위치

### 레이어 4 Transport Layer

 흐름 컨트론, 에러 복구 기능을 가진다.

 > TCP, UTP

보낼 떄에는 AH -> PH

받을떄에는 PH -> AH

보낼 때에 여러 헤더와 같은 정보가 붙기에 속도가 좀 더 느리게 나온다.

## 프로토콜 (Protocol)

 > PC가 서로 통신하기 위한 협약, 규약이다.

 같은 프로토콜을 가져야 서로 통신이 가능하다.

### TCP/IP
 > Transmission Control Protocol/ Internet Protocol

 TCP, UTP - 트랜스포트 계층
 IP - 인터넷 계층

### IPX
 > Internetwork Packet eXchange

 파일 서버와 클라이언트 간에 통신에서 사용하는 방법 - 요즘에는 거의 없어졌다.

## IP주소
 > 전 세계적으로 유일한 주소, 둘이쓰면 충돌나서 한명 밖에 못쓴다.

 NIC(Network Information Center)에서 공인 주소를 관리한다.

### NAT
> Network Address Translation

 내부 네트워크에서는 공인되지 않은 IP 주소를 사용하고 인터넷으로 나갈 떄에만 공인 주소를 사용하는 방법

IPv4의 수는 최대 2^32개이다.

IPv6의 수는 최대 2^128개이다.

## DHCP
 > Dynamic Host Configuration Protocol

 PC마다 하나하나 IP 주소를 미리 지정해 놓지 않고 DHCP 서버가 네트워크에 필요한 IP 주소를 가지고 있다가 자동분배해주는 방식

## NIC | 랜카드
> Network Interface Card, 네트워크 어뎁터

### PC의 버스 방식
 > 버스 (컴퓨터에 데이터가 날아다니는 길)

 PCI, ISA, EISA 방식이 있다.

## HUB 허브
 > 같은 허브에 연결된 PC끼리는 서로 통신이 가능하다.

 허브 = 멀티포트(Multiport) 리피터 (Repeater)

 UTP 케이블 최대 거리가 대부분 100미터이지만 리피터를 이용하여 거리를 더 늘릴 수 있다.

 허브는 CSMA/CD 방식을 사용한다. 같은 허브에 연결되어있는 모든 PC를 `같은 Collision Domain`에 있다고 한다.

 파워를 넣으면 바로 작동 - 명령어 불필요

### HUB의 종류
 > Intelligent hub, Dummy hub, Semi-Intelligent hub, Stackable hub

### 인텔리전트 허브 (Intelligent hub)
> 지능형 허브

NMS(Network Management System)을 통해 데이터 분석, 제어 등 관리 가능

문제가 발생한 PC가 연결된 포트를 자동으로 고립(네트워크에서 불리)시키는 기능을 가지고 있다.

또한 분리된 포트는 허브에서 램프(LED)로 표시되기 떄문에 조치가 쉬워진다. (Auto Partition)

### 세미 더미 허브 (Semi Dummy hub)

 > 카멜레온

인텔리전트 허브와 연결하면 인텔리전트 허브가 되고

혼자 있을 때는 더미 허브

### 스태커블 허브 (Stackable hun)
 > 쌓을 수 있는 허브

  다른 장비에는 형향을 주지 않는다. 

  단독형(Standalone)에 비해 효율적으로 설계되었다.

## 브리지 (Bridge), 스위치 (Switch)
 > 콜리전 도메인을 나누어 줄 수 있는 장비

 속도 : 브리지 < 스위치

 ### 스위치 (Switch)

 `포트별로 콜리전 도메인이 나누어져 있다.` 고로 PC들도 동시 통신이 가능하다.

 이거 자꾸 까먹는다.

 > 스위치와 허브의 가장 큰 차이이다.

![허브와 스위치의 차이](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/1e73ae65-01e3-42c4-804e-f8813c7a0f22)


위는 고속도로로 네트워크 흐름을 비유한 것

### 허브와 스위치의 차이

 > 가격 : 허브 < 스위치
 >
 > 속도 : 허브 > 스위치

 허브는 네트워크 트래픽이 적은 채팅이나 메일 용도

 허브는 콜리전 도메인을 나눠줄 수 없지만 스위치는 가능하다

 ![스위치는 콜리전 도메인을 나눌 수 있다](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/6d585a5f-8d79-4fa9-ab47-d2fffbb0bdf0)

스위치는 라우터까지의 길 또한 콜리전 도메인에 포함된다.

### 브리지 (Bridge)
 
 > 브리지는 허브로 만들어진 콜리전 도메인 사이에 중간 다리를 놓는 것 

 사실상 스위치와 사촌

### 브리지, 스위치의 기능

 - Learning 배운다.
 - Flooding 모르면 들어온 포트를 제외한 다른 모든 포트로 뿌린다.
 - Forwarding 해당 포트로 건네준다.
 - Filtering 다른 포트로는 못 건너가게 막는다.
 - Aging 나이를 먹는다?

 > Learning : 출발지의 MAC 어드레스를 배운다.
 
 어떤 컴퓨터가 브리지나 스위치를 통해 통신을 하기 위해 프레임을 보내면 보낸 PC의 MAC 주소를 `MAC 주소 테이블 (브리지 테이블)`에 저장한다.

 > Flooding : 들어온 포트를 제외한 나머지 모든 포트로 뿌린다.

 Mac 어드레스 테이블에 없는 주소일 경우

 브로드캐스트나 멀티 캐스트의 경우에도 발생한다.

 > Forwarding (포워딩) : 목적지가 어디있는지 알고 있지만 목적지가 다리를 건너야 하는 경우 발생한다.

 Flooding과 달리 특정 포트에만 프레임을 뿌려준다.

 > Filtering (필터링) : 브리지를 넘어가지 못하게 한다.

 목적지의 MAC주소를 알고 있고 출발지와 목적지가 같은 세그먼트에 있는 경우, 브리지를 건너가지 않아도 통신을 할 수 있을 경우 필터링한다.

 이 기능으로 인해 콜리전 도메인을 나누어 줄 수 있다.

 > Aging : 나이를 먹는다?

 브리지 테이블은 어느정도 시간이 지나면 정보를 브리지 테이블에서 지우게 된다. 마치 우리 머리 속처럼.

 디폴트 기억시간은 5분

 300초가 지나도록 그 출발지 주소를 가진 프레임이 들어오지 않으면 브리지 테이블에서 삭제시킨다.

 Aging 타이머를 리프래시 (Refresh)한다 : 시간 안에 브리지로 들어오게 되면 타이머를 리셋하고 처음부터 다시 카운트 한다.

 ### 브리지와 스위치의 차이점

 > 속도 : 스위치가 브리지에 비해 훨씬 빠르다.

 스위치는 하드웨어 방식으로 이루어지고 브리지는 소프트웨어 방식으로 프레임을 처리한다. 사용한다.

 > 속도 지원
 
 스위치는 서로 다른 속도를 연결해 줄 수 있지만 허브는 모든 포트가 같은 속도만 지원된다.

 > 포트 수

 스위치는 브리지에 비해 제공하는 포트 수가 훨씬 많다.

 > 프레임 처리 방식

 스위치 : Cut-through, Store-and-forward
 
 브리지 : Store-and-forward

 - 스토어 앤 포워드 (Store-and-forward) : 프레임을 전부 받아들인 후 처리, 에러가 발생하면 프레임을 전부 버리고 재전송 요구, 에러 복구 능력 뛰어남
  
 - 컷스루 (Cut-through) : 프레임의 목적지와 주소만 본 후 바로 전송 처리, 목적지 주소만 보고 바로 보내기에 처음 48bit만 본다. 에러 복구 능력 부족

 - 프래그먼트 프리 (Fragment-free) : 위 두 방식의 장점을 결합, 처음 512bit만 보고 에러 판단

## Looping

 > 프레임이 네트워크상에서 무한정 돌게되어 데이터 전송이 불가능해지는 상태

 브리지/스위치에 목적지까지의 경로가 두개 이상 존재하면 루핑 발생

 ![루핑](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/6f17008f-484e-42ac-b9eb-cd85f897ef3c)

 이 현상을 막기 위한 알고리즘 `스패닝 트리 알고리즘 (Spanning Tree Algorithm)`

## 폴트 톨러런트 (Fault Tolerant), 로드 밸런싱 (Load Balancing)

 > 폴트 톨러런트

 `두 대`의 라우터로 네트워크를 구성 한 후 한 대가 죽었을 때 다른 라우터가 기존 라우터를 대체하는 것

 장애  대비책으로 대부분 이중구조를 의미하고 전체 네트워크가 하나의 지점에서 발생한 장애로 인해 영향 받는 것을 방지하기 위한 것.

 > 로드 밸런싱

  하나의 인터넷 회선을 이용한 인터넷 접속 대신 두개의 인터넷 회선을 이용하는 것.

  데이터가 두 라인중 하나를 선택하기에 로드가 분산되는 효과를 얻어 속도가 두배가 된다.

  추가적으로 회선이 하나가 끊어지면 다른 회선으로 이전하게 되는데 이 떄를 로드 밸런싱과 폴트 톨러런트를 겸하게 된다.

 ## 스패닝 트리 알고리즘 (Spanning Tree Algorithm)

 > 자동으로 루핑을 검색해서 루핑이 발생할 수 있는 상황을 미리 막아주는 역할을 한다.

 스위치 간의 링크 중 하나를 끊어 놓는 것이다. 실제 링크는 두 개이지만 데이터는 한 쪽으로만 다니게 하는 것이다.

 루핑을 미리 막기 위해 두 개 이상의 경로가 발생하면 하나를 제외하고 나머지 경로를 자동으로 막아두었다가 기존 경로에 문제가 생기면 막아놓은 경로를 풀어서 데이터를 전송하는 알고리즘

 링크가 끊어진 후 다시 연결되는 대 까지는 약 1분 이상 소요된다.

 ## 라우팅 혹은 스위칭

 가격 : 라우터가 스위치보다 비싸다

 속도 : 라우터는 내부에서 처리하는 것이 많기에 스위치가 더 빠르다.

 구성의 편리함 : 스위치는 전원만 공급해 주면 된다.


 그럼 스위치로만 구성하면 되는가? 아니다.

 통신을 할 때에 상대편 MAC 주소를 찾기 위해 ARP(Address Resolution Protocol), 브로드캐스트를 사용

 스위치는 콜리전 도메인만 나눌 뿐. 브로드캐스트 도메인을 나눠주기 위해 라우터를 사용한다. 라우터 역할을 하는 스위치를 `레이어 3 스위치`라고 부른다.

 ![브로드캐스트 도메인](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/abdaddae-7dfe-44e0-a48d-ec25d4c70149)

 브로드캐스트 영역을 나눌 때에는 사용하는 프로토콜이나 프로그램에 따라 차이가 있다.

 - IP : 500 노드
 - IPX : 300 노드
 - AppleTalk : 200 노드
  
 노드 : 네트워크에 접속되는 장비, 주로 PC 숫자

 라우터는 스위치가 못하는 보안 기능인 `패킷 필터링` 기능을 제공한다. 네트워크 주소에 따라 전송을 막았다가 풀었다 하는 필터 기능을 제공하여 불필요한 트래픽이 전송되는 것을 막는다.

 또한 `로드 분배`기능을 가지고 있다.
 - 로드 분배 : 여러 개의 경로를 가지고 있기에 한쪽 경로에 문제가 생겨도 바로 다른 경로로 보낼 수 있다.

## IP 주소

 > 규칙이 있는 개인 번호

 IP 주소는 이진수 32자리로 되어있기에 총 2^32개가 있다. 읽기 쉽게 하기 위해서 IP 주소를 총 4개의 옥텟(8)으로 나눈다.

 ### IP 배정 방식
 라우터에 배정해야 하는 IP 주소는 두개

 1. 이더넷 인터페이스용
 2. 시리얼 (Serial) 인터페이스용 

 ### 네트워크 부분과 호스트 부분

 > 한 네트워크 : 하나의 브로드캐스트 영역, 라우터를 거치지 않고 통신이 가능한 영역

 한 네트워크 상에서 `네트워크 부분`은 모두 같아야 하며 `호스트 부분`은 전부 달라야한다.

 라우터의 인터페이스를 건너뛰면서 네트워크가 달라진다.

 ### IP 주소의 Class

 > 네트워크의 크기에 따른 구분법

 - 클래스 A : 맨 앞쪽 하나가 항상 0으로 시작된다.
  
 `0xxx xxxx`.xxxx xxxx.xxxx xxxx.xxxx xxxx
 
 `앞의 8비트`는 네트워크 부분, 나머지 24비트는 호스트 부분

 네트워크 번호가 1~126으로 시작, 하지만 127은 제외 이건 약속

 호스트가 전부 0인 경우는 네트워크 주소이고 호스트가 전부 1인 경우는 호스트 모두에게 전송하는 브로드캐스트 주소이기 떄문에 가능한 호스트 수는 `2^24 - 2`개 이다.

 - 클래스 B : 맨 앞이 반드시 10(이진수)로 시작된다.
  
 `10xx xxxx.xxxx xxxx`.xxxx xxxx.xxxx xxxx

 `앞의 16비트`는 네트워크 부분, 나머지 16비트는 호스트 부분

 네트워크 번호가 128.1 ~ 191.255로 시작

 모두 0인 경우와 모두 1인 브로트캐스트 주소를 제외한

 가능한 호스트의 수는 `2^16 - 2`개 이다

 - 클래스 C : 맨 앞이 110(이진수)로 시작된다.

 `110x xxxx.xxxx xxxx.xxxx xxxx`.xxxx xxxx

 `앞의 24비트`는 네트워크 부분, 나머지 8비트는 호스트 부분이다.

 네트워크 번호가 192.0.0 ~ 223.255.255 로 시작

 가능한 호스트 수는 위와 동일한 이유로 `2^8 -2`개 이다.

### IP 클래스 정리

 - 클래스 A : 1~126 (127은 예비번호), 255.0.0.0
 - 클래스 B : 128~191, 255.255.0.0
 - 클래스 C : 192~223, 255.255.255.0
 - 클래스 D : 224~239 (멀티캐스트용 주소)
 - 클래스 E : 240~255 (연구용 주소)

## 서브넷 마스크 (Subnet Mask)

> 주어진 IP 주소를 네트워크 환경에 맞게 나누어 주기 위해서 씌워주는 이진수의 조합

브로트캐스트 영역을 나누기 위해 사용한다.

> 서브넷 마스크는 IP 주소를 가지고 어디 까지가 네트워크 부분이고 어디까지가 호스트 부분인지를  나타내는 역할을 한다.

네트워크는 서브넷 마스크가 이진수로 `1`인 부분이고 호스트는 이진수로 `0`인 부분이다.

### 서브네팅 (Subnetting)

하나의 주소를 서브넷 마스크를 씌워서 작은 네트워크로 만드는 것을 의미한다.

기존 IP 주소의 호스트 부분의 일부를 네트워크 부분으로 바꾸는 작업

ex)

`150.150.100.1`의 디폴트 서브넷 마스크는 255.255.0.0 이지만 새로운 서브넷 마스크인 255.255.255.0을 씌워 클래스 B 주소를 마치 클래스 C 처럼 사용하는 것이다.

### 서브넷 마스크의 기본 성질

>서브넷은 하나의 네트워크이기 때문에 서로 나뉜 서브넷 끼리는 라우터를 통해서만 통신이 가능하다.

- 서브넷 마스크는 이진수로 썼을 떄 `1`이 연속적으로 나와야 한다. 1과 1사이에 0이 있으면 안된다.

1111 1111.1111 1111.1111 1111.1110 0000 -> 가능 <br/>
1111 1111.1111 1111.1111 1111.1011 0000 -> 불가능

## 스패닝 트리 (Spanning Tree Protocol, SPT)

 > 목적지가 2개 이상 존재할 때 1개의 경로만 남겨두고 나머지는 끊어두었다가 사용하던 경로에 문제가 생기면 다른 하나를 사용하는 방법

 ### 브리지 ID (BID)

 Bridge ID 는 총 64비트(8Byte)로 이루어저 있고 그 중 앞의 16비트(2Byte)는 `Bridge Priority`, 나머지 48비트(6Byte)는 `Mac Address`로 구성되어있다.

 > `xxxx xxxx xxxx xxxx` oooo oooo oooo oooo oooo oooo oooo oooo oooo oooo oooo oooo

 그 중 `Bridge Priority`는 2^16 - 1 가지가 올 수 있으며 디폴트 값은 중간 값인 32768(16 진수로는 8000)을 사용한다. `Mac Address`는 앞과 마찬가지로 고정된 값이다.

 > Priority는 낮은 값이 더 높은 우선순위를 갖는다.
 
 ### Path Cost

 > 브리지가 얼마나 가까이, 빠른 링크로 연결되어있는지 알아내기 위한 값이다

 원래 계산법은 1000Mbps를 연결되어있는 링크 대역폭으로 나눈 값이다

 예를들어 10Mbps로 연결되어있는 두 스위치라면 Path cost는  100이다

 차지만 요즘은 속도가 더 빨라졌기 때문에 소수점까지 값이 내려가는 것을 방지하기 위해 값을 고정시켜 놓았다.
 
 |Bandwidth(대역폭)|STP Cost(path Cost)|
 |:---:|:---:|
 |4Mbps|250|
 |10Mbps|100|
 |16Mbps|62|
 |45Mbps|39|
 |100Mbps|19|
 |155Mbps|14|
 |622Mbps|6|
 |1Gbps|4|
 |100Gbps|2|

 ### 스패닝 트리 프로토콜

 > 1. 네트워크당 하나(브로드캐스트 도메인)의 루트 브리지(Root Bridge)를 가진다
 > 2. 루트 브리지가 아닌 나머지 모든 브리지(Non Root Bridge)는 무조건 하나씩의 루트 포트(Root Port)를 가진다
 > 3. 세그먼트(Segment)당 하나씩의 데지그네이티드 포드(Designated Port)를 갖는다

#### Root Bridge?

 스패닝 트리 프로토콜을 수행할 때 기준이 되는 브리지(혹은 스위치)

#### Non Root Bridge?

 루트 브리지를 제외한 모든 브리지(스위치), 무조건 하나씩의 `루트 포트`즉 루트 브리지까지 가장 빨리 갈 수 있는 포트를 가진다

#### Segment?

 브리지(스위치) 사이에 서로 연결된 링크

 세그먼트당 하나씩의 지정포트(Designated Port)를 갖는다

 ![스패닝트리 프로토콜](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/e7888ee0-3ba5-46cf-84a4-33f3e0a05217)

스패닝트리 프로토콜에서 루트 포트나 지정포트가 아닌 나머지 모든 포트는 막아버린다

### STP에서의 순서

 > 1. 누가 더 작은 Root BID를 가졌는가?
 > 2. 루트 브리지까지의 Path Cost 값은 누가 더 작은가?
 > 3. 누구의 BID(Sender BID)가 더 낮은가?
 > 4. 누구의 포트 ID가 더 낮은가?
 
 브리지(스위치)는 스패닝 트리 정보를 주고받기 위해 매 2초 간격으로 `BPDU(Bridge Protocol Data Unit)`을 뿌리고 이를 통해 포트를 결정하게 된다

 BPDU 안에는 `Root BID`, `Root Path Cost`, `Sender Bid`, `Port ID`를 담고있다

 루트 포트 -> Designated Port -> Non Designated Port

### 실제 스위치에서 값 변경, 확인하기

```
sw(config)#spanning-tree vlan 1 priority 100

sw(config)#show spanning-tree
```

추후 전체적인 실습 기록할 떄 없어질 수도

### STP에서 루트 포트 선출하기

 > Path Cost가 가장 적게 드는 포트가 가장 루트 포트에 가까이 있다는 의미

 ![루트 브리지 선출](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/e4bc62f1-0fdc-4a01-8b55-84872a6d88c7)

 위 예시에서 스위치 A는 루트 브리지, 스위치 B의 E0와 스위치 C의 E0가 루트 포트이다

### STP에서 Designated Port 선출하기

 > 세그먼트 상에서 Root Path Cost를 서로 비교해서 더 작은 Root Path Cost를 가진 포트가 Designated Port로 선출된다

 ![Designated Port](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/d932775c-dd49-49d2-b87d-3856578f104f)

 위 예시에서는 세그먼트 1에서는 스위치 A의 E0, 세그먼트 2에서는 스위치 A의 E1이 Designated Port가 된다

 - 루트 브리지의 모든 포트들은 언제나 Designated Port로 선정

 세그먼트 3에서는 Root Path Cost값이 같기에 위의 4단계를 통해 결정하게 된다

 책의 예시에서는 Sender BID, 즉 자신의 BID값이 더 작은 B의 E1이 Designated Port로 선정되었다

 그리고 나머지 포트 (여기서는 스위치 C의 E1)은 `ND(Non Designated Port)`가 된다

 ![STP 결과](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/b0e6dcb8-4f62-403f-97c6-93bfdf36a3dd)


 ### STP에서 스위치 포트의 5가지 상태변화

 #### Disabled

 고장나서 사용 불가이거나 일부러 정지시켜 놓은 상태

 - 데이터 전송 불가
 - MAC Address Learning 불가
 - BPDU 송신 및 수신 불가

 #### Blocking

 맨 처음 켜지거나 Disable상태에서 활성화 시켰을 때

 - 데이터 전송 불가
 - MAC Address Learning 불가
 - BPDU 송신 및 수신 가능

 #### Listening

 Blocking 상태에 있던 포트가 루트 포트나 Designated Port로 선정되면 Listening 상태로 변경, 하지만 다른 포트로 상태가 변하면 다시 Blocking 상태가 된다

 - 데이터 전송 불가
 - MAC Address Learning 불가
 - BPDU 송신 및 수신 가능

 #### Learning

 Listening 상태에 있던 포트가 포워딩 딜레이(Forwarding Delay) 디폴트 시간인 15초 동안 유지되면 러닝 상태로 변경, 이제야 MAC Address 테이블을 만들기 시작

 - 데이터 전송 불가
 - MAC Address Learning 가능
 - BPDU 송신 및 수신 가능

 #### Forwarding

 Learning 상태에서 변하지 않고 포워딩 딜레이 디폴트 시간인 15초 동안 유지되면 포워딩 상태로 변경

 - 데이터 전송 가능
 - MAC Address Learning 가능
 - BPDU 송신 및 수신 가능

 <img src = "https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/8f48c018-6da3-41e5-b4c9-42c912b840a5" alt = "SPT 포트 선정" width="75%" height="75%">


 ### STP  연결 이후

 STP 사이클이 완전하게 된 후

 루트 브리지는 매 2초마다 Hello BPDU를 Non Root Bridge에 전송하고 받은 후 다시 루트 브리지로 전송하여 길이 아직 살아있다는 것을 알려준다

 하지만 만약 이 시간동안 헬로패킷을 받지 못하면 중간에 문제가 발생했다고 생각하여 다시 스패닝 트리를 재편성 하는 모드로 들어간다

 - Hello Time (헬로타임) : 루트 브리지가 '살아있나요?'하고 물어보는 시간, 디폴트 헬로타임은 2초
  
 - Max Age (맥스 에이지) : 브리지들이 루트 브리지로부터 얼마 동안 헬로패킷을 받지 못했을 때 루트브리지가 죽었다고 생각하고 새로운 스패닝트리를 만들기 시작하는 시간, 디폴트는 20초
  
 - Forwarding Delay (포워딩 딜레이) : 블로킹 -> 포워딩으로 넘어가는 데 걸리는 시간, 하지만 실제 블로킹에서 포워딩으로 넘어가기 위해서는 블로킹 -> 러닝 -> 포워딩으로 넘어가야 하기에 실제 걸리는 시간은 포워딩 딜레이 시간의 두배가 된다.

## 카타리스트 스위치
 
 > 라우터

 - PoE : `Power over Ethernet` 이더넷 케이블에 데이터 + 전원을 실어 보내는 것

 Catalyst 2960-48PST-L 을 예시로
 
 48포트이고 P가 들어갔으니 PoE를 지원한다.

 P뒤의 S와 T는 TP(UTP)방식과 SFP(Small FormFactor Pluggable - 광캐이블)방식을 사용한다.

 P뒤에 C가 있다면 'Dual Purpose Uplink' 즉 SFP혹은 Base T 포트 중 선택하여 사용할 수 있다는 뜻이다

 ### LED 상태

 ![포트 LED 상태 pdf](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/f915a3ee-bf19-42ae-86e3-63ac177dadd9)

 ## 스위치 구성

 > Cisco Packet Tracer를 이용하여 시뮬레이션 해보았다, 책을 따라서

 나는 Cisco 장비가 없기에 트레이서를 통해 시뮬레이션 해보기로 하였다

 ![switch 구성](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/9466b8f0-d9f4-4558-9bc5-18a9d7a93adb)

 구성은 이렇게 책에서는 Catalyst 2950스위치를 사용하라고 하였기에 트레이서에서 가장 비슷한 친구를 가지고 왔다

 스위치에서 각 포트들의 상황을 볼 수 있는 명령어는 `show interface status`이다

 ```
 Switch#show interface status
Port      Name               Status       Vlan       Duplex  Speed Type
Fa0/1                        connected    trunk      auto    auto  10/100BaseTX
Fa0/2                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/3                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/4                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/5                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/6                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/7                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/8                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/9                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/10                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/11                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/12                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/13                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/14                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/15                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/16                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/17                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/18                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/19                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/20                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/21                       notconnect   trunk      auto    auto  10/100BaseTX
 ```

 여기서 Duplex는 통신 방식으로 `Half Duplex`는 무전기처럼 한번에 한쪽에서만 전송할 수 있는 방식이고 `Full Duplex`는 동시에 양방향 통신이 가능한 것을 의미한다

 Speed 또한 10Mbps와 100Mbps의 속도에서 선택이 가능하다는 뜻이다

 위 상황 모두 통신하여는 양쪽 모두 같은 상태를 가져야 통신이 가능하다

 콘솔을 통해 명령어를 입력하기 위해 컴퓨터를 한대 더 추가해 주었다

 스위치(console), 컴퓨터(rs232)

 ![switch 구성 콘솔 추가](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/40a5e2da-b045-4a55-9bd5-eccb993220e9)

 이번에는 `#` 표시가 아닌 `>`표시 즉 `유저 모드, Switch>` 로 들어왔다 유저모드에서는 스위치의 상태만 볼 수 있고 구성을 확인하거나 변경하기 위해서는 `Privileged 모드`로 들어가야한다

 이를 위해 `enable`이라는 명령어를 사용할 수 있다

 ```
 Switch>enable
 Switch#
 ```

 이제는 `>`에서 `#`모양으로 바뀌었고 이 상태가 `Privileged 모드`이다

 이 상태에서 스위치의 구성을 변경하기 위해 `구성 모드`로 들어가야 한다

 ```
 Switch#configure terminal
 Enter configuration commands, one per line.  End with CNTL/Z.
 Switch(config)#
 ```

 이런식으로 `Switch#`에서 `Switch(config)#`로 변경되면 구성모드가 된 것이다

 이제 IP주소를 세팅하기 위해 컴퓨터와 연결된 Vlan 1으로 들어가서 세팅을 해보자

 ```
 Switch(config)#interface vlan 1
 Switch(config-if)#ip address 192.168.100.1 255.255.255.0
 Switch(config-if)#
 ```

 IP는 192.168.100.1로 서브넷 마스크는 255.255.255.0으로 설정했다 구성모드를 빠져나올 때에는 exit명령어를 사용하면 된다

 ```
 Switch(config-if)#exit   -> 인터페이스 구성 모드에서 구성 모드로
 Switch(config)#exit      -> 구성 모드에서 프리빌리지드 모드로
 Switch#
 ```

 확인을 해보자

 ```
 Switch#show interface vlan 1
 Vlan1 is administratively down, line protocol is down
  Hardware is CPU Interface, address is 00e0.f93a.63c3 (bia 00e0.f93a.63c3)
  Internet address is 192.168.100.1/24
  MTU 1500 bytes, BW 100000 Kbit, DLY 1000000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input 21:40:21, output never, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     1682 packets input, 530955 bytes, 0 no buffer
     Received 0 broadcasts (0 IP multicast)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     563859 packets output, 0 bytes, 0 underruns
     0 output errors, 23 interface resets
     0 output buffer failures, 0 output buffers swapped out
 ```

 IP주소가 성공적으로 할당되었다

 이번에는 디폴트 게이트웨이를 구성해보자

 사실 지금 시뮬레이션에서는 라우터와 다른 스위치가 없기에 통신을 할 일이 없지만 만약 있다고 가정하고 해보자

 ```
 Switch#configure terminal
 Enter configuration commands, one per line.  End with CNTL/Z.
 Switch(config)#ip default-gateway 192.168.1.1
 Switch(config)#exit
 Switch#
 ```

 이번에는 스위치의 포트와 Duplex를 세팅해보자

 ```
 Switch#configure terminal
 Enter configuration commands, one per line.  End with CNTL/Z.
 Switch(config)#interface fastethernet 0/1
 ```

 프리빌리지드 모드에서 변경해주고자 하는 인터페이스로 들어간다

 이번에는 fastethernet 0/1

 ```
 Switch(config-if)#speed ?
  10    Force 10 Mbps operation
  100   Force 100 Mbps operation
  auto  Enable AUTO speed configuration
 Switch(config-if)#Duplex ?
  auto  Enable AUTO duplex configuration
  full  Force full duplex operation
  half  Force half-duplex operation
 ```

 명령어를 잘 모를 경우 뒤에 ?를 붙이면 넣을 수 있는 옵션이 나온다

 ```
Switch(config-if)#speed 10
Switch(config-if)#duplex half
Switch(config-if)#exit
 ```
 
 속도는 10Mbps, Duplex는 half 옵션을 사용하였다

 ```
Switch#show interface fastethernet 0/1
FastEthernet0/1 is up, line protocol is up (connected)
  Hardware is Lance, address is 0060.2fde.3301 (bia 0060.2fde.3301)
 BW 10000 Kbit, DLY 1000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Half-duplex, 10Mb/s       -> 여기
  input flow-control is off, output flow-control is off
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input 00:00:08, output 00:00:05, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue :0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     956 packets input, 193351 bytes, 0 no buffer
     Received 956 broadcasts, 0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored, 0 abort
     0 watchdog, 0 multicast, 0 pause input
     0 input packets with dribble condition detected
     2357 packets output, 263570 bytes, 0 underruns
     0 output errors, 0 collisions, 10 interface resets
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out
 ```

 매우 길지만 중간에 보면 Half-duplex, 10Mb/s라고 설정이 되었다

 ## 맥 어드레스는 어디에?

 - Dynamic 방식 : 자동으로 배우는 방식
 - Permanent 방식 : 수동으로 넣어주는 방식

 Mac 테이블을 보기 위해 `show mac-address-table`을 이용하여 확인해 보자

 ```
Switch#show mac-address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----

Switch#
 ```

 어...음... 통신을 안했으니 비어있는 것이 당연하다

 고로 통신을 위한 컴퓨터를 추가해 주어 ping명령어를 통해 잠시 통신을 해보자

 ![switch 구성 통신 추가](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/71c694b2-0a3f-4e39-a473-26eb70201840)

 PC1 : 200.200.200.1

 PC2 : 200.200.200.2

 ```
C:\>ping 200.200.200.2

Pinging 200.200.200.2 with 32 bytes of data:

Reply from 200.200.200.2: bytes=32 time=14ms TTL=128
Reply from 200.200.200.2: bytes=32 time<1ms TTL=128
Reply from 200.200.200.2: bytes=32 time<1ms TTL=128

Ping statistics for 200.200.200.2:
    Packets: Sent = 3, Received = 3, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 14ms, Average = 4ms

Control-C
^C
C:\>
 ```

 통신을 성공적으로 하였으니 이제 다시 MAC 테이블을 확인해 보자

 ```
Switch#show mac-address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----

   1    0001.42b9.7439    DYNAMIC     Fa0/2
   1    0060.700c.204e    DYNAMIC     Fa0/1
 ```

 드디어 두 컴퓨터의 MAC 주소가 보이게 되었다

 맨 앞에는 Vlan이 나오고 그 옆에는 Mac주소, 그 옆에는 이 주소를 배운 방식이 Dynamic인지 Permanent인지에 대한 내용이, 마지막으로는 패킷을 어느 쪽으로 보낼지에 관련된 부분으로 첫번째 줄을 보자면 패스트 이더넷 0/2, 두번째 줄에서는 패스트 이더넷 0/1로 보낸다

 ### 스태틱 맥 어드레스 (static Mac Address)

 > 맥 주소 테이블에 저장되어 지워질 일이 없는 주소
 
 - 지워질 걱정 없음
 - 주소가 바뀌어도 자동으로 수정 불가능
 - 메모리가 낭비될 수 있음
 
 명령어의 기본 형식을 살펴보자면

 ```
Switch (config) #mac-address-table static 'Mac 주소' vlan 'vlan id' interface 'interface id'
 ```

 `Mac 주소`는 스태틱으로 지정할 MAC 주소

 `vlan id`는 MAC 주소르 받아들인 vlan

 `interface id`는 이 맥 주소를 목적지로 하는 주소가 들어오면 이 인터페이스 쪽으로 보낸다

 이제 직접 설정해 보자

 ```
Switch#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#mac-address-table static aaaa.aaaa.aaaa vlan 1 interface fastEthernet 0/24
 ```

 Mac 주소 aaaa.aaaa.aaaa가 vlan1을 통해 들어오면 패스트 이더넷 0/24로 보내라는 것을 스태틱으로 구현했다

 ```
Switch#show mac-address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----

   1    aaaa.aaaa.aaaa    STATIC      Fa0/24
 ```

 확인을 해보면 원래 있던 Dynamic 방식으로 만들어진 테이블은 시간이 지남에 따라 통신을 하지 않으니 테이블에서 사라졌고 스태틱 주소는 잘 유지되어있는 것을 볼 수 있다

 맥 주소를 전부 지우려면? `clear mac-address-table`

 ```
Switch#clear mac-address-table
Switch#show mac-address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----
 ```

 ## Vlan (Virtual Lan)?

 > VLAN을 이용하여 한대의 스위치를 마치 여러대의 분리된 스위치처럼 사용

 가상 랭을 이용하여 하나의 스위치에 연결된 장비들의 브로드캐스트 도메인을 나눌 수 있다

 여러 개의 네트워크로 나누어진 VLAN 간의 통신은 `오로지 라우터를 통해서만` 가능하다

 하나의 포트를 통해 서로 다른 여러 개의 VLAN을 전송할 수 있게 하는 포트를 `트렁크 포트(Trunk Port)`라고 한다

 ### 트렁킹

 - 트렁킹 : 여러개의 VLAN을 한 번에 전송하는 방식

 트렁킹에 패킷을 태울 때 각각의 패킷에 이름을 붙여준다, 그리고 그 방식에는 ISL 트렁킹과  IEEE 802.1Q방식이 있다

 #### 네이티브 VLAN (Native VLAN)

 트렁킹을 할 때에 패킷에는 전부 이름표가 붙지만 이름표가 붙지 않은 패킷은 네이티브 VLAN으로 보내진다

 스위치 네트워크에서 유일하게 한 개의 VLAN만을 네이티브 VLAN으로 세팅 가능하다

 #### ISL (Inter-Switch Link)

 시스코 장비 끼리만 사용하는 방식

 네이티브 VLAN이라는 개념 없이 모든 VLAN에 이름을 붙인다

 #### IEEE 802.1Q

 표준 프로토콜

 ### VTP (VLAN Trunking Protocol)

 > 스위치들이 가지고 있는 VLAN 정보를 항상 일치시켜 주기 위한 프로토콜

 시스코에서만 존재하는 프로토콜

 #### VTP의 3가지 모드

 `VTP 서버 모드` : 
 
 VLAN을 생성, 삭제, 이름변경할 수 있고 도메인 안에 있는 다른 스위치에게 VTP 도메인 이름과 VLAN 구성을 전달해 줄 수 있다. VLAN의 정보를 비휘발성 RAM인 NVRAM에 저장해 놓았기에 꺼졌다 켜저도 저장된 정보를 잃지 않는다.

 `VTP 클라이언트 모드` :

 VLAN을 만들거나 삭제, 이름변경이 `불가능`하다. VTP 서버가 전달해준 VLAN 정보를 받고 받은 정보를 다른 VTP 클라이언트에게 전달해 주는 것만 가능하다. 꺼졌다 켜졌을 경우 정보가 날아간다.

 `VTP 트랜스페어런트 모드 (Transparent Mode)` :

 VTP 도메인 안에서 살며 VLAN을 만들고 삭제할 수 있지만 만든 정보를 다른 스위치에게 알려주지 않는다. 하지만 서버를 통해 들어온 메시지를 다른 스위치로 전달해 주는 역할만 한다.

 쉽게말해 나 혼자만 산다. (전달만)

 로컬 위치에서 사용할 VLAN을 가진 스위치의 경우에 사용이 적합하며 NVRAM에 정보를 저장한다.

 ### VLAN 구성하기

 1. VTP 도메인 이름 만들기
 2. VTP 모드 설정 - 서버, 클라이언트, 트랜스페어런트
 3. VLAN 구성

 그럼 시작해 봅시다

 ```
Switch(config)#VTP domain cisco
Changing VTP domain name from NULL to cisco
Switch(config)#
 ```

 책을 따라서 VTP 이름을 cisco로 설정합시다

 ```
Switch(config)#vtp mode server
Device mode already VTP SERVER.
Switch(config)#
 ```

 모드를 서버로 구현하면? 이미 되어있다고 하는군요

 ```
Switch#show vtp status
VTP Version                     : 1
Configuration Revision          : 0
Maximum VLANs supported locally : 255
Number of existing VLANs        : 5
VTP Operating Mode              : Server
VTP Domain Name                 : cisco
VTP Pruning Mode                : Disabled
VTP V2 Mode                     : Disabled
VTP Traps Generation            : Disabled
MD5 digest                      : 0xAA 0xB9 0x0C 0xCD 0xD7 0xE8 0xA6 0xE0 
Configuration last modified by 0.0.0.0 at 0-0-00 00:00:00
Local updater ID is 0.0.0.0 (no valid interface found)
Switch#
 ```

 전체 상태를 보면? 이제 Mode는 server 도메인 이름은 cisco로 잘 설정되었네요

 이제 트렁크 포트를 설정해 봅시다

 라고 했는데 위에서 실습을 할 때 사용한 스위치는 세팅을 할 때 뭔가 이상해서 찾아보니 페스트 이더넷을 사용하려면 2950-24가 아니라 2950T-24를 사용해야 한다더군요.. 이런

 ![switch 구성 통신 추가 T](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/14b7c7cc-61f4-4c7c-94b2-d87fffd15ef7)

 이제 다시 처음부터 트렁크 포트를 설정하기 전까지 하고 오도록 하죠

 위 과정을 다시 하고 나서 이제 트렁크 포트를 세팅해 봅시다

 ```
Switch#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#int fa 0/1
Switch(config-if)#switchport ?
  access         Set access mode characteristics of the interface
  mode           Set trunking mode of the interface
  nonegotiate    Device will not engage in negotiation protocol on this
                 interface
  port-security  Security related command
  priority       Set appliance 802.1p priority
  protected      Configure an interface to be a protected port
  trunk          Set trunking characteristics of the interface
  voice          Voice appliance attributes
Switch(config-if)#switchport mode trunk
Switch(config-if)#
 ```
 자 세팅이 되었습니다. 이 방식은 catalyst 2950버전으로 트렁크 모드가 IEEE 802.1Q만 존재하기에 ISL방식이 없다고 합니다

 이제 세팅이 제대로 되었는지 확인을 해 봅시다 `show interface fa0/1 switchport`

 ```
Switch#show interface fa0/1 switchport
Name: Fa0/1
Switchport: Enabled
Administrative Mode: trunk
Operational Mode: trunk
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: dot1q
Negotiation of Trunking: On
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)
Voice VLAN: none
Administrative private-vlan host-association: none
Administrative private-vlan mapping: none
Administrative private-vlan trunk native VLAN: none
Administrative private-vlan trunk encapsulation: dot1q
Administrative private-vlan trunk normal VLANs: none
Administrative private-vlan trunk private VLANs: none
Operational private-vlan: none
Trunking VLANs Enabled: All
Pruning VLANs Enabled: 2-1001
Capture Mode Disabled
Capture VLANs Allowed: ALL
Protected: false
Appliance trust: none
 ```

 여기서 dot1q는 트렁크모드 중 IEEE 802.1Q라고 합니다

 잘 되었네요 스위치 전체에서 트렁크로 세팅된 포트를 살펴봅시다 `show interface trunk`

 ```
Switch#show interface trunk
Port        Mode         Encapsulation  Status        Native vlan
Fa0/1       on           802.1q         trunking      1
Fa0/2       desirable    n-802.1q       trunking      1

Port        Vlans allowed on trunk
Fa0/1       1-1005
Fa0/2       1-1005

Port        Vlans allowed and active in management domain
Fa0/1       1
Fa0/2       1

Port        Vlans in spanning tree forwarding state and not pruned
Fa0/1       1
Fa0/2       1
 ```

 Fa0/1가 트렁크로 설정된 포트입니다

 이제 VLAN을 만들어봅시다

 `show vlan`명령어를 통해 VLAN이 각 포트에 어떻게 배정되어있는지 확인할 수 있습니다

```
Switch#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/3, Fa0/4, Fa0/5, Fa0/6
                                                Fa0/7, Fa0/8, Fa0/9, Fa0/10
                                                Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15, Fa0/16, Fa0/17, Fa0/18
                                                Fa0/19, Fa0/20, Fa0/21, Fa0/22
                                                Fa0/23, Fa0/24, Gig0/1, Gig0/2
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active    

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0   
1003 tr    101003     1500  -      -      -        -    -        0      0   
1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
1005 trnet 101005     1500  -      -      -        ibm  -        0      0   
```

 디폴트로 대부분의 포트가 (0/1, 0/2 제외 전부) VLAN으로 연결되어있음을 알 수 있습니다

 책에서는 Fa0/2 또한 VLAN 1에 속해있던데 아무래도 두대의 컴퓨터를 연결할 떄에 뭔가 잘못 한 것 같군요

```
Switch#show interface status
Port      Name               Status       Vlan       Duplex  Speed Type
Fa0/1                        connected    trunk      auto    auto  10/100BaseTX
Fa0/2                        connected    trunk      auto    auto  10/100BaseTX
Fa0/3                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/4                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/5                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/6                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/7                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/8                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/9                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/10                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/11                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/12                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/13                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/14                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/15                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/16                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/17                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/18                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/19                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/20                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/21                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/22                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/23                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/24                       notconnect   trunk      auto    auto  10/100BaseTX
Gig0/1                       notconnect   1          auto    auto  10/100BaseTX
Gig0/2                       notconnect   1          auto    auto  10/100BaseTX
```

 어... 뭔가 잘못됬네요 분명 Fa0/1만 trunk로 만들었을 텐데 전부 다 변했군요

 다시 한대의 컴퓨터만 연결 후 시도해 보겠습니다

```
Switch#show interface trunk
Port        Mode         Encapsulation  Status        Native vlan
Fa0/1       on           802.1q         trunking      1

Port        Vlans allowed on trunk
Fa0/1       1-1005

Port        Vlans allowed and active in management domain
Fa0/1       1

Port        Vlans in spanning tree forwarding state and not pruned
Fa0/1       1
```

 일단 trunk 포트는 한가지군요

```
Switch#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/5
                                                Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/11, Fa0/12, Fa0/13
                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
                                                Fa0/18, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24, Gig0/1
                                                Gig0/2
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active    

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0   
1003 tr    101003     1500  -      -      -        -    -        0      0   
1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
1005 trnet 101005     1500  -      -      -        ibm  -        0      0   
```

 VLAN에도 1번으로 모든 포트가 연결되어있군요

```
Switch#show int status
Port      Name               Status       Vlan       Duplex  Speed Type
Fa0/1                        connected    trunk      auto    auto  10/100BaseTX
Fa0/2                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/3                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/4                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/5                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/6                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/7                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/8                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/9                        notconnect   trunk      auto    auto  10/100BaseTX
Fa0/10                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/11                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/12                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/13                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/14                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/15                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/16                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/17                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/18                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/19                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/20                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/21                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/22                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/23                       notconnect   trunk      auto    auto  10/100BaseTX
Fa0/24                       notconnect   trunk      auto    auto  10/100BaseTX
Gig0/1                       notconnect   1          auto    auto  10/100BaseTX
Gig0/2                       notconnect   1          auto    auto  10/100BaseTX
```

 음... 아무래도 기본 세팅이 trunk로 되어있나봅니다

```
Switch#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#int range fa0/2-24
Switch(config-if-range)#sw mo acc
Switch(config-if-range)#sw acc vlan 1
Switch(config-if-range)#exit
Switch(config)#exit
Switch#
%SYS-5-CONFIG_I: Configured from console by console
Switch#show int status
Port      Name               Status       Vlan       Duplex  Speed Type
Fa0/1                        connected    trunk      auto    auto  10/100BaseTX
Fa0/2                        notconnect   1          auto    auto  10/100BaseTX
Fa0/3                        notconnect   1          auto    auto  10/100BaseTX
Fa0/4                        notconnect   1          auto    auto  10/100BaseTX
Fa0/5                        notconnect   1          auto    auto  10/100BaseTX
Fa0/6                        notconnect   1          auto    auto  10/100BaseTX
Fa0/7                        notconnect   1          auto    auto  10/100BaseTX
Fa0/8                        notconnect   1          auto    auto  10/100BaseTX
Fa0/9                        notconnect   1          auto    auto  10/100BaseTX
Fa0/10                       notconnect   1          auto    auto  10/100BaseTX
Fa0/11                       notconnect   1          auto    auto  10/100BaseTX
Fa0/12                       notconnect   1          auto    auto  10/100BaseTX
Fa0/13                       notconnect   1          auto    auto  10/100BaseTX
Fa0/14                       notconnect   1          auto    auto  10/100BaseTX
Fa0/15                       notconnect   1          auto    auto  10/100BaseTX
Fa0/16                       notconnect   1          auto    auto  10/100BaseTX
Fa0/17                       notconnect   1          auto    auto  10/100BaseTX
Fa0/18                       notconnect   1          auto    auto  10/100BaseTX
Fa0/19                       notconnect   1          auto    auto  10/100BaseTX
Fa0/20                       notconnect   1          auto    auto  10/100BaseTX
Fa0/21                       notconnect   1          auto    auto  10/100BaseTX
Fa0/22                       notconnect   1          auto    auto  10/100BaseTX
Fa0/23                       notconnect   1          auto    auto  10/100BaseTX
Fa0/24                       notconnect   1          auto    auto  10/100BaseTX
Gig0/1                       notconnect   1          auto    auto  10/100BaseTX
Gig0/2                       notconnect   1          auto    auto  10/100BaseTX
```

 이렇게 설정하였고 한줄 씩 보자면

```
Switch(config)#int range fa0/2-24
```

 포트 fa0/2부터 fa0/24까지 선택

```
Switch(config-if-range)#sw mo acc
```

 선택된 포트를 설정하기 위한 준비

```
Switch(config-if-range)#sw acc vlan 1
```

 VLAN 1로 설정

 하면 이제야 책과 같은 환경이 되었습니다

 아직 저는 배우는 단계이기에 최대한 책을 따라가며 기록할 계획입니다...

 만 책을 보니 fa0/2의 duplex나 speed가 바뀌어있던데 이건 아마 위의 다른 작업과정에서 설정을 한 것으로 보입니다

 #### VLAN 세팅하는 방법

 - VLAN을 VLAN Configuration 모드에서 세팅하는 방법 (CatOS 방식)

```
Switch#vlan database
% Warning: It is recommended to configure VLAN from config mode,
  as VLAN database mode is being deprecated. Please consult user
  documentation for configuring VTP/VLAN in config mode.

Switch(vlan)#
```

 - VLAN을 Config-VLAN 모드에서 세팅하는 방법 (IOS 방식)

이름을 설정해서 접속 가능

```
Switch#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#vlan 2
Switch(config-vlan)#
```

#### VLAN 만들기

```
Switch(config)#vlan 2
Switch(config-vlan)#name CCND
Switch(config-vlan)#^Z
Switch#
%SYS-5-CONFIG_I: Configured from console by console

Switch#
```

 CCND 라는 이름의 VLAN 2를 생성

```
Switch#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/5
                                                Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/11, Fa0/12, Fa0/13
                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
                                                Fa0/18, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24, Gig0/1
                                                Gig0/2
2    CCND                             active    
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active    
```

 VLAN 2에 CCND 라는 이름의 VLAN이 생성되었다

#### VLAN 삭제

 no만 붙여주면 된다

```
Switch#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#no vlan 2
Switch(config)#^Z
Switch#
%SYS-5-CONFIG_I: Configured from console by console

Switch#
```

```
Switch#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/5
                                                Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/11, Fa0/12, Fa0/13
                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
                                                Fa0/18, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24, Gig0/1
                                                Gig0/2
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active 
```