---
title: "[C] 포트 스캐닝"
date: 2024-06-15 23:56:15 +09:00
categories: [Linux, C, Port scanning]
tags: [C]
pin: true
---

# 지난번에 이어서

지난번에는 `Bash shell`을 이용한 포트 스캐너를 만들었다

사실 가장 최근에 다른 작업을 잠시 하게 되며 흥미를 가지게 된 언어여서 가능하면 `Bash`를 이용해 `nmap`에 있는 기능들을 구현해 보고자 하였다

허나 `shell`만의 기능으로는 `3-way-handshake` 외의 기능은 구현하기에 어려움이 있었고 다른 언어와 섞어 스크립트를 구현하고자 한다

사실 처음에는 LUA라는 언어를 사용해볼까 하는 생각을 한 적이 있다

LUA는 nmap의 근간이 되는 언어이기에 nmap과 비슷한 기능을 구현할 수 있다면 가장 최적의 언어가 아닐까 싶었다

그러다 [RustScan](https://github.com/RustScan/RustScan)이라는 nmap보다 더 빠른 속도를 가진다고 하는 다른 스캐너를 발견하게 되었다

그래서 또 다시 코드를 살펴보기 시작했지만...

아직 나의 실력으로는 코드를 이해하기에 어려움이 있었다

만약 코드를 뜯어본다 하여도 그 시간이 매우 오래 걸릴 것이라 생각해 이번에는 일단 내가 써본적이 있는 언어인 `C`언어를 선택하게 되었다

python이 탈락한 이유는... 느리다

사실 가장 쉽게 짤 수 있게 사람들이 많이 글을 올려놓기도 하였다만 나는 그 글에 나오는 스캔 방식이 결국 `bash`로 만들었던 기능과 유사했기에 이번에는 `C`를 이용할 것이다

## Tcp Half Open Scan - Tcp SYN Scan

![tcp_halfopenscan](https://github.com/oil-lamp-cat/oil-lamp-cat.github.io/assets/103806022/76f2a664-4fff-44d2-8170-08fe679dc673)

`Tcp SYN Scan`은 SYN을 보내고 SYN/ACK를 받으면 바로 RST패킷을 보내 연결되지 않도록하여 스텔스 스캔이라고 불리기도 한다

세션 연결에 대한 로그가 남지 않지만 SYN 전송에 대한 기록이 남기에 엄연히 말하자면 완전한 스텔스는 아닌 모양이다

# 코드 구현

자 이제 진짜 시작이다

1. 타겟에 SYN 신호를 보냄
2. SYN/ACK 신호가 돌아오면 열린 포트
3. RST 혹은 FIN 패킷을 보내 바로 연결 되기 전에 종료
4. RST/ACK 플래그가 돌아오면 닫힌 포트

## 1차